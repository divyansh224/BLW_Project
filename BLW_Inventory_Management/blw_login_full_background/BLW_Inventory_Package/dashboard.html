
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<title>BLW Spare Parts Inventory Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<style>
    body {
      margin: 0;
      background:url('background.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: Arial, sans-serif;
      color: #333;
    }

    .sidebar {
      width: 250px;
      height: 100vh;
      position: fixed;
      background-color: #0b1d3a;
      color: white;
      padding: 20px 10px;
    }

    .sidebar h3 {
      text-align: center;
      font-size: 1.3rem;
      margin-bottom: 20px;
    }

    .sidebar img {
      width: 80px;
      display: block;
      margin: 0 auto 10px;
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
    }

    .sidebar ul li {
      padding: 10px;
      cursor: pointer;
    }

    .sidebar ul li:hover {
      background-color: #14335d;
    }

    .content {
      margin-left: 250px;
      padding: 20px;
    }

    .cards {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .card-box {
      flex: 1;
      padding: 20px;
      color: white;
      font-weight: bold;
      text-align: center;
      border-radius: 10px;
    }

    .card-red { background-color: #e74c3c; }
    .card-yellow { background-color: #f39c12; }
    .card-blue { background-color: #3498db; }
    .card-green { background-color: #27ae60; }

    .filter-bar {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
    }
    
     .table-container {
      background: rgba(255,255,255,0.95);
      padding: 15px;
      border-radius: 10px;
    }
    
.table th:nth-child(1),
.table td:nth-child(1) {
  min-width: 160px;
  word-break: break-word;
  white-space: normal;
}

#downloadBtn {
  position: fixed;
  top: 20px;
  right: 20px;
  background-color: transparent;
  color: white;
  border: 2px solid white;
  padding: 8px 14px;
  border-radius: 6px;
  font-weight: bold;
  z-index: 999;
  transition: all 0.3s ease;
  backdrop-filter: blur(4px); /* Optional: adds a frosted glass feel */
}

#downloadBtn:hover {
  background-color: rgba(255, 255, 255, 0.1);
  color: #00ffe5;
  border-color: #00ffe5;
  cursor: pointer;
}
     
  </style>
</head>
<body>
<div class="sidebar">
<img alt="BLW Logo" src="logo.png"/>
<h3>BLW Inventory</h3>
<ul>
<li><i class="fas fa-chart-bar"></i> Dashboard</li>
<li><i class="fas fa-warehouse"></i> Warehouse</li>
<li><i class="fas fa-tools"></i> Repair</li>
<li><i class="fas fa-box"></i> Supplies</li>
<li><i class="fas fa-exchange-alt"></i> Transport</li>
<li><i class="fas fa-cogs"></i> Electrical Dept</li>
<li><i class="fas fa-wrench"></i> Mechanical Dept</li>
<li><i class="fas fa-train"></i> Traction Dept</li>
</ul>
</div>
<div id="pdfContent">
  <div class="content">
<div class="cards">
  <div class="card-box card-red" id="total_items">78<br/>Total Inventory Items</div>
  <div class="card-box card-yellow" id="available_box">1857<br/>Available Parts</div>
  <div class="card-box card-blue" id="in_use_box">2254<br/>In Use</div>
  <div class="card-box card-green" id="in_repair_box">109<br/>In Repair</div>
</div>
<div class="filter-bar">
<input class="form-control" placeholder="Search Part..." type="text"/>
<select class="form-control">
<option value="">Select Department</option>
<option>Mechanical</option>
<option>Electrical</option>
<option>Traction</option>
<option>Stores</option>
<option>Maintenance</option>
</select>
<button class="btn btn-primary">Search</button>
</div>
<div class="table-container">
  <div style="overflow-x: auto; max-width: 100%;">
<table class="table table-striped table-bordered" style="min-width: 1000px;">
<thead>
<tr><th>RFID</th><th>Part Name</th><th>Department</th><th>In Use</th><th>In Repair</th><th>Available</th></tr>
</thead>
<tbody id="inventoryBody"><tr><td>RFID-1001</td><td>Traction Motor Frame</td><td>Mechanical</td><td>28</td><td>3</td><td>15</td></tr><tr><td>RFID-1002</td><td>Axle</td><td>Mechanical</td><td>30</td><td>5</td><td>22</td></tr><tr><td>RFID-1003</td><td>Gear Box Housing</td><td>Mechanical</td><td>25</td><td>7</td><td>10</td></tr><tr><td>RFID-1004</td><td>Brake Cylinder</td><td>Mechanical</td><td>32</td><td>2</td><td>18</td></tr><tr><td>RFID-1005</td><td>Bearing Cap</td><td>Mechanical</td><td>40</td><td>4</td><td>30</td></tr><tr><td>RFID-1006</td><td>Bogies</td><td>Mechanical</td><td>18</td><td>2</td><td>5</td></tr><tr><td>RFID-1007</td><td>Couplers</td><td>Mechanical</td><td>20</td><td>3</td><td>12</td></tr><tr><td>RFID-1008</td><td>Wheel Sets</td><td>Mechanical</td><td>24</td><td>5</td><td>10</td></tr><tr><td>RFID-1009</td><td>Buffer Assembly</td><td>Mechanical</td><td>12</td><td>1</td><td>9</td></tr><tr><td>RFID-1010</td><td>Radiator Fan</td><td>Mechanical</td><td>15</td><td>4</td><td>8</td></tr><tr><td>RFID-1011</td><td>Motor Mount Bracket</td><td>Mechanical</td><td>20</td><td>3</td><td>14</td></tr><tr><td>RFID-1012</td><td>Air Reservoir</td><td>Mechanical</td><td>18</td><td>2</td><td>20</td></tr><tr><td>RFID-1013</td><td>Sand Box</td><td>Mechanical</td><td>14</td><td>1</td><td>12</td></tr><tr><td>RFID-1014</td><td>Axle Box Housing</td><td>Mechanical</td><td>9</td><td>2</td><td>6</td></tr><tr><td>RFID-1015</td><td>Brake Shoe</td><td>Mechanical</td><td>50</td><td>0</td><td>40</td></tr><tr><td>RFID-1016</td><td>Suspension Spring</td><td>Mechanical</td><td>24</td><td>1</td><td>18</td></tr><tr><td>RFID-1017</td><td>Equalizing Beam</td><td>Mechanical</td><td>11</td><td>2</td><td>9</td></tr><tr><td>RFID-1018</td><td>Side Bearer</td><td>Mechanical</td><td>17</td><td>1</td><td>13</td></tr><tr><td>RFID-1019</td><td>Brake Hanger</td><td>Mechanical</td><td>8</td><td>0</td><td>7</td></tr><tr><td>RFID-1020</td><td>Traction Bar</td><td>Mechanical</td><td>6</td><td>1</td><td>4</td></tr><tr><td>RFID-1021</td><td>Traction Motor</td><td>Electrical</td><td>26</td><td>6</td><td>14</td></tr><tr><td>RFID-1022</td><td>Armature Coil</td><td>Electrical</td><td>30</td><td>5</td><td>20</td></tr><tr><td>RFID-1023</td><td>Rectifier Unit</td><td>Electrical</td><td>17</td><td>2</td><td>11</td></tr><tr><td>RFID-1024</td><td>Circuit Breaker</td><td>Electrical</td><td>22</td><td>1</td><td>18</td></tr><tr><td>RFID-1025</td><td>Control Panel</td><td>Electrical</td><td>15</td><td>3</td><td>6</td></tr><tr><td>RFID-1026</td><td>Power Converter</td><td>Electrical</td><td>19</td><td>2</td><td>13</td></tr><tr><td>RFID-1027</td><td>Pantograph</td><td>Electrical</td><td>10</td><td>1</td><td>7</td></tr><tr><td>RFID-1028</td><td>Insulator</td><td>Electrical</td><td>20</td><td>0</td><td>15</td></tr><tr><td>RFID-1029</td><td>Cable Harness</td><td>Electrical</td><td>35</td><td>4</td><td>25</td></tr><tr><td>RFID-1030</td><td>Battery Set</td><td>Electrical</td><td>12</td><td>2</td><td>9</td></tr><tr><td>RFID-1031</td><td>Blower Motor</td><td>Electrical</td><td>16</td><td>1</td><td>11</td></tr><tr><td>RFID-1032</td><td>Power Contactor</td><td>Electrical</td><td>9</td><td>1</td><td>5</td></tr><tr><td>RFID-1033</td><td>Intercooler Fan Motor</td><td>Electrical</td><td>8</td><td>0</td><td>6</td></tr><tr><td>RFID-1034</td><td>Fuse Box</td><td>Electrical</td><td>18</td><td>1</td><td>14</td></tr><tr><td>RFID-1035</td><td>Busbar</td><td>Electrical</td><td>10</td><td>2</td><td>12</td></tr><tr><td>RFID-1041</td><td>Welding Torch</td><td>Repair &amp; Overhaul</td><td>8</td><td>1</td><td>7</td></tr><tr><td>RFID-1042</td><td>Hydraulic Press</td><td>Repair &amp; Overhaul</td><td>6</td><td>2</td><td>4</td></tr><tr><td>RFID-1043</td><td>Drilling Machine</td><td>Repair &amp; Overhaul</td><td>5</td><td>2</td><td>3</td></tr><tr><td>RFID-1044</td><td>Lifting Jack</td><td>Repair &amp; Overhaul</td><td>9</td><td>1</td><td>6</td></tr><tr><td>RFID-1045</td><td>Grinding Machine</td><td>Repair &amp; Overhaul</td><td>4</td><td>1</td><td>2</td></tr><tr><td>RFID-1061</td><td>Welding Rod</td><td>Welding Shop</td><td>100</td><td>0</td><td>50</td></tr><tr><td>RFID-1062</td><td>Welding Machine</td><td>Welding Shop</td><td>10</td><td>2</td><td>8</td></tr><tr><td>RFID-1063</td><td>Welding Helmet</td><td>Welding Shop</td><td>15</td><td>1</td><td>20</td></tr><tr><td>RFID-1081</td><td>Insulation Tester</td><td>Testing Lab</td><td>6</td><td>0</td><td>3</td></tr><tr><td>RFID-1082</td><td>High Voltage Tester</td><td>Testing Lab</td><td>4</td><td>1</td><td>2</td></tr><tr><td>RFID-1083</td><td>Resistance Meter</td><td>Testing Lab</td><td>7</td><td>2</td><td>5</td></tr><tr><td>RFID-1101</td><td>Nut &amp; Bolts Set</td><td>Assembly</td><td>120</td><td>0</td><td>100</td></tr><tr><td>RFID-1102</td><td>Spring Washer</td><td>Assembly</td><td>85</td><td>0</td><td>75</td></tr><tr><td>RFID-1121</td><td>Lubricant Oil</td><td>Stores</td><td>80</td><td>0</td><td>60</td></tr><tr><td>RFID-1122</td><td>Coolant</td><td>Stores</td><td>70</td><td>0</td><td>55</td></tr><tr><td>RFID-1123</td><td>Cleaning Solvent</td><td>Stores</td><td>45</td><td>0</td><td>40</td></tr><tr><td>RFID-1124</td><td>Grease Gun</td><td>Stores</td><td>25</td><td>1</td><td>20</td></tr><tr><td>RFID-1125</td><td>Safety Gloves</td><td>Stores</td><td>150</td><td>0</td><td>200</td></tr><tr><td>RFID-1126</td><td>Packing Material</td><td>Stores</td><td>280</td><td>0</td><td>300</td></tr><tr><td>RFID-1127</td><td>Identification Tags</td><td>Stores</td><td>120</td><td>0</td><td>100</td></tr><tr><td>RFID-1128</td><td>Toolbox</td><td>Stores</td><td>10</td><td>1</td><td>10</td></tr><tr><td>RFID-1129</td><td>Spare Keys</td><td>Stores</td><td>35</td><td>0</td><td>30</td></tr><tr><td>RFID-1130</td><td>Inventory Bin</td><td>Stores</td><td>55</td><td>0</td><td>50</td></tr><tr><td>RFID-1201</td><td>Side Frame</td><td>Mechanical</td><td>22</td><td>2</td><td>18</td></tr><tr><td>RFID-1202</td><td>Traction Link</td><td>Mechanical</td><td>18</td><td>1</td><td>12</td></tr><tr><td>RFID-1203</td><td>Bogie Pivot Pin</td><td>Mechanical</td><td>10</td><td>0</td><td>7</td></tr><tr><td>RFID-1204</td><td>Buffer Pad</td><td>Mechanical</td><td>16</td><td>1</td><td>14</td></tr><tr><td>RFID-1205</td><td>Draft Gear</td><td>Mechanical</td><td>8</td><td>0</td><td>5</td></tr><tr><td>RFID-1206</td><td>Center Pivot Bush</td><td>Mechanical</td><td>6</td><td>0</td><td>6</td></tr><tr><td>RFID-1207</td><td>Brake Lever</td><td>Mechanical</td><td>12</td><td>1</td><td>8</td></tr><tr><td>RFID-1208</td><td>Wheel Hub</td><td>Mechanical</td><td>14</td><td>1</td><td>10</td></tr><tr><td>RFID-1209</td><td>Suspension Tube</td><td>Mechanical</td><td>6</td><td>0</td><td>4</td></tr><tr><td>RFID-1210</td><td>Axle End Cap</td><td>Mechanical</td><td>10</td><td>1</td><td>6</td></tr><tr><td>RFID-1211</td><td>Field Coil</td><td>Electrical</td><td>20</td><td>2</td><td>15</td></tr><tr><td>RFID-1212</td><td>Interlock Relay</td><td>Electrical</td><td>14</td><td>1</td><td>10</td></tr><tr><td>RFID-1213</td><td>LED Module</td><td>Electrical</td><td>40</td><td>0</td><td>30</td></tr><tr><td>RFID-1214</td><td>Fuse Link</td><td>Electrical</td><td>60</td><td>0</td><td>50</td></tr><tr><td>RFID-1215</td><td>Control Switch</td><td>Electrical</td><td>18</td><td>2</td><td>12</td></tr><tr><td>RFID-1216</td><td>TCMS Processor</td><td>Electrical</td><td>5</td><td>1</td><td>3</td></tr><tr><td>RFID-1217</td><td>Switchgear Housing</td><td>Electrical</td><td>9</td><td>0</td><td>6</td></tr><tr><td>RFID-1218</td><td>Light Indicator</td><td>Electrical</td><td>16</td><td>0</td><td>14</td></tr><tr><td>RFID-1219</td><td>Current Sensor</td><td>Electrical</td><td>6</td><td>0</td><td>5</td></tr><tr><td>RFID-1220</td><td>Voltage Detector</td><td>Electrical</td><td>7</td><td>1</td><td>4</td></tr></tbody>
</table>
</div>
</div>
</div>
</div>
<button id="downloadBtn" onclick="downloadPDF()">‚¨áÔ∏è PDF</button>
<script>
  // üîí Redirect to login if not authenticated
  const user_id = localStorage.getItem('user_id');
  if (!user_id) {
    window.location.href = '/blw_login_full_background/login.html';
  }

  // üîÅ Load inventory into the table
  async function loadTable() {
    const res = await fetch('/api/parts');
    const data = await res.json();
    const tbody = document.getElementById('inventoryBody');
    tbody.innerHTML = '';

    data.forEach(part => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${part.rfid}</td>
        <td>${part.name}</td>
        <td>${part.department}</td>
        <td>
          ${part.in_use}
          <button onclick="update('${part.rfid}', 'in_use', 1)">+</button>
          <button onclick="update('${part.rfid}', 'in_use', -1)">‚Äì</button>
        </td>
        <td>
          ${part.in_repair}
          <button onclick="update('${part.rfid}', 'in_repair', 1)">+</button>
          <button onclick="update('${part.rfid}', 'in_repair', -1)">‚Äì</button>
        </td>
        <td>
          ${part.available}
          <button onclick="update('${part.rfid}', 'available', 1)">+</button>
          <button onclick="update('${part.rfid}', 'available', -1)">‚Äì</button>
        </td>
      `;
      tbody.appendChild(row);
    });

    filterTable(); // Apply filters after loading
  }

  // üîß Update inventory value
  async function update(rfid, field, value) {
    await fetch('/api/parts/update', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ rfid, field, value })
    });
    loadTable();
    loadSummary();
  }

  // üìä Update summary cards
  async function loadSummary() {
    const res = await fetch('/api/summary');
    const data = await res.json();

    document.getElementById('in_use_box').firstChild.textContent = data.in_use_total;
    document.getElementById('in_repair_box').firstChild.textContent = data.in_repair_total;
    document.getElementById('available_box').firstChild.textContent = data.available_total;

    const total = data.in_use_total + data.in_repair_total + data.available_total;
    document.getElementById('total_items').firstChild.textContent = total;
  }

  // üîé Filter by keyword and department
  function filterTable() {
    const searchVal = document.querySelector('.filter-bar input').value.toLowerCase();
    const deptVal = document.querySelector('.filter-bar select').value;
    const rows = document.querySelectorAll('tbody tr');

    rows.forEach(row => {
      const cells = row.querySelectorAll('td');
      const matchSearch = Array.from(cells).some(td =>
        td.innerText.toLowerCase().includes(searchVal)
      );
      const matchDept = !deptVal || cells[2].innerText === deptVal;
      row.style.display = matchSearch && matchDept ? '' : 'none';
    });
  }

  // üß™ Filter triggers
  document.querySelector('.filter-bar input').oninput = filterTable;
  document.querySelector('.filter-bar select').onchange = filterTable;

  // üöÄ Initial load
  window.onload = () => {
    loadTable();
    loadSummary();
  };
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
<script>
function downloadPDF() {
  const content = document.getElementById('pdfContent');
  if (!content) {
    alert("üìõ pdfContent not found. Wrap your exportable data in <div id='pdfContent'>");
    return;
  }

  html2pdf()
    .set({
      margin: 0.2,
      filename: 'inventory-report.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2, useCORS: true },
      jsPDF: { unit: 'mm', format: 'a3', orientation: 'landscape' }
    })
    .from(content)
    .save();
}
</script>
</body>
</html>
