<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login ‚Ä¢ BLW Inventory System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      background: url('assets/profile.jpg') no-repeat center center fixed;
      background-size: cover;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: Arial, sans-serif;
    }
    .header {
      width: 100%;
      padding: 20px;
      display: flex;
      justify-content: flex-start;
    }
    .header img {
      width: 80px;
    }
    .login-box {
      background-color: rgba(0, 0, 0, 0.85);
      border: 1px solid #333;
      width: 360px;
      padding: 40px;
      margin-top: 30px;
      text-align: center;
      color: white;
    }
    .form-control {
      background-color: #262626;
      border: 1px solid #555;
      color: white;
    }
    .form-control::placeholder {
      color: #aaa;
    }
    .btn-primary {
      background-color: #0095f6;
      border: none;
      font-weight: bold;
    }
    .btn-primary:hover {
      background-color: #0077cc;
      transform: scale(1.05);
      transition: 0.2s ease-in-out;
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="assets/logo.png" alt="BLW Logo" />
  </div>

  <div class="login-box">
    <h1 id="header">BLW Assset System</h1>
    <script>
      let txt = ' BLW Login Page';
      let i = 0;
      function typeIt() {
        if (i <= txt.length) {
          document.getElementById('header').innerHTML = txt.slice(0, i) + '|';
          i++;
          setTimeout(typeIt, 100);
        }
      }
      typeIt();
    </script>

    <form id="loginForm">
      <input class="form-control mb-2" placeholder="User ID" id="user_id" required />
      <div class="input-group mb-3">
        <input class="form-control" type="password" placeholder="Password" id="password" required />
        <button class="btn btn-outline-light" type="button" onclick="togglePassword()">üëÅÔ∏è</button>
      </div>
      <button class="btn btn-primary w-100 mb-2" type="submit">Log in</button>
    </form>

    <p id="status" class="mt-2 text-info"></p>

    <div class="mt-3">
      <a href="#" class="text-light text-decoration-none">Forgot password?</a>
    </div>
    <div class="text-center mt-3">
      <span class="text-light">Don't have an account?</span>
      <button class="btn btn-sm btn-outline-light" data-bs-toggle="modal" data-bs-target="#signupModal">Sign Up</button>
    </div>
  </div>

  <!-- üîê Sign-Up Modal -->
  <div class="modal fade" id="signupModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title">Create Account</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <form id="signupForm">
          <div class="modal-body">
            <input class="form-control mb-2" placeholder="Full Name" id="signupName" required />
            <input class="form-control mb-2" placeholder="User ID" id="signupUserID" required />
            <input class="form-control mb-2" type="password" placeholder="Password" id="signupPassword" required />
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary" type="submit">Register</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- üß† Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function togglePassword() {
      const pwd = document.getElementById('password');
      pwd.type = pwd.type === 'password' ? 'text' : 'password';
    }

    document.getElementById('loginForm').onsubmit = async (e) => {
      e.preventDefault();
      const user_id = document.getElementById('user_id').value;
      const password = document.getElementById('password').value;
      const status = document.getElementById('status');
      status.innerHTML = `<div class="d-flex gap-2 align-items-center"><div class="spinner-border text-info"></div><span>Logging in...</span></div>`;

      try {
        const res = await fetch('http://localhost:3000/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ user_id, password })
        });
        const result = await res.json();
        if (res.ok) {
          localStorage.setItem('user_id', user_id);
          status.innerHTML = `<span class="text-success">Login successful! Redirecting...</span>`;
          setTimeout(() => {
            window.location.href = 'index.html';
          }, 1000);
        } else {
          status.innerHTML = `<span class="text-danger">${result.error}</span>`;
        }
      } catch (err) {
        status.innerHTML = `<span class="text-danger">Server unreachable. Try again later.</span>`;
      }
    };

    document.getElementById('signupForm').onsubmit = async (e) => {
      e.preventDefault();
      const name = document.getElementById('signupName').value;
      const user_id = document.getElementById('signupUserID').value;
      const password = document.getElementById('signupPassword').value;

      if (name.length < 2 || user_id.length < 3 || password.length < 4) {
        alert("üö´ Invalid credentials. Please check and try again.");
        return;
      }

      try {
        const res = await fetch('http://localhost:3000/auth/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, user_id, password })
        });
        const result = await res.json();
        if (res.ok) {
          localStorage.setItem('user_id', user_id);
          window.location.href = 'index.html';
        } else {
          alert('‚ùå ' + result.error);
        }
      } catch {
        alert('‚ö†Ô∏è Server error during signup.');
      }
    };
  </script>
</body>
</html>